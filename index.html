<!doctype html>
<meta charset="utf-8">
<title>MM connect smoke test</title>
<button id="btn">ウォレット接続テスト</button>
<pre id="out"></pre>
<script>
  const out = document.getElementById('out');
  function log(...a){ out.textContent += a.join(' ') + '\n'; console.log(...a); }

  log('page loaded');
  log('navigator=', navigator.userAgent);
  log('ethereum=', typeof window.ethereum);

  async function testConnect(){
    log('click detected');
    if (!window.ethereum){ alert('MetaMaskが見つかりません'); return; }
    try{
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      log('accounts=', accounts);
      alert('接続OK: ' + accounts[0]);
    }catch(e){
      log('connect error:', e.message || e);
      alert('接続エラー: ' + (e.message || e));
    }
  }

  // 2系統でバインド（どちらかは必ず効く）
  document.getElementById('btn').addEventListener('click', testConnect);
  window.testConnect = testConnect;
</script>
